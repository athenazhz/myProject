package com.qingniao.core.service.impl;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.qingniao.common.page.PageInfo;
import com.qingniao.core.dao.product.ImgMapper;
import com.qingniao.core.dao.product.ProductMapper;
import com.qingniao.core.pojo.product.Img;
import com.qingniao.core.pojo.product.ImgExample;
import com.qingniao.core.pojo.product.Product;
import com.qingniao.core.pojo.product.ProductExample;
import com.qingniao.core.service.ProductService;
@Service
@Transactional
public class ProductServiceImpl implements ProductService {
	@Autowired
	private ProductMapper productMapper;
	@Autowired
	private ImgMapper imgMapper;
	public void insertProduct(Product product) {
		productMapper.insertSelective(product);
	}
	@Override
	public PageInfo selectByExample(ProductExample productExample) {
		PageInfo pageInfo = new PageInfo(productExample.getPageNo(),productExample.getPageSize(),productMapper.countByExample(productExample));
		productExample.setPageNo(pageInfo.getPageNo());
		List<Product> productList = productMapper.selectByExample(productExample);
		for (Product product : productList) {
			ImgExample imgExample = new ImgExample();
			imgExample.createCriteria().andProductIdEqualTo(product.getId()).andIsDefEqualTo(true);
			List<Img> imgList = imgMapper.selectByExample(imgExample);
			if (imgList.size()>0) {
				product.setImg(imgList.get(0));
			}
		}
		pageInfo.setList(productList);
		return pageInfo;
	}
}
